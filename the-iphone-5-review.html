<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Custom Code to Understand a Custom Core - BlinkVib</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Section by Anand Shimpi All Computer Engineers at NCSU had to take mandatory programming courses. Given that my dad is a Computer Science professor, I always had exposure to programming, but I never considered it my strong suit - perhaps me gravitating towards hardware was some passive rebellious thing. Either way I knew that in"><meta name=robots content="index,follow,noarchive"><meta property="og:title" content="Custom Code to Understand a Custom Core"><meta property="og:description" content="Section by Anand Shimpi All Computer Engineers at NCSU had to take mandatory programming courses. Given that my dad is a Computer Science professor, I always had exposure to programming, but I never considered it my strong suit - perhaps me gravitating towards hardware was some passive rebellious thing. Either way I knew that in"><meta property="og:type" content="article"><meta property="og:url" content="/the-iphone-5-review.html"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-09-02T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-02T00:00:00+00:00"><meta itemprop=name content="Custom Code to Understand a Custom Core"><meta itemprop=description content="Section by Anand Shimpi All Computer Engineers at NCSU had to take mandatory programming courses. Given that my dad is a Computer Science professor, I always had exposure to programming, but I never considered it my strong suit - perhaps me gravitating towards hardware was some passive rebellious thing. Either way I knew that in"><meta itemprop=datePublished content="2024-09-02T00:00:00+00:00"><meta itemprop=dateModified content="2024-09-02T00:00:00+00:00"><meta itemprop=wordCount content="1208"><meta itemprop=keywords content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=https://assets.cdnweb.info/hugo/mainroad/css/style.css><link rel="shortcut icon" href=./favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=./index.html title=BlinkVib rel=home><div class="logo__item logo__text"><div class=logo__title>BlinkVib</div></div></a></div><div class=divider></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Custom Code to Understand a Custom Core</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2024-09-02T00:00:00Z>September 02, 2024</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=./categories/blog/ rel=category>blog</a></span></div></div></header><div class="content post__content clearfix"><p>Section by Anand Shimpi</p><p>All Computer Engineers at NCSU had to take mandatory programming courses. Given that my dad is a Computer Science professor, I always had exposure to programming, but I never considered it my strong suit - perhaps me gravitating towards hardware was some passive rebellious thing. Either way I knew that in order to really understand Swift, I'd have to do some coding on my own. The only problem? I have zero experience writing Objective-C code for iOS, and not enough time to go through a crash course.</p><p>I had code that I wanted to time/execute in C, but I needed it ported to a format that I could easily run/monitor on an iPhone. I enlisted the help of a talented developer friend who graduated around the same time I did from NCSU, Nirdhar Khazanie. Nirdhar has been working on mobile development for years now, and he quickly made the garbled C code I wanted to run into something that executed beautifully on the iPhone. He gave me a framework where I could vary instructions as well as data set sizes, which made this next set of experiments possible. It's always helpful to know a good programmer.</p><p>So what did Nirdhar's app let me do? Let's start at the beginning. ARM's Cortex A9 has two independent integer ALUs, does Swift have more? To test this theory I created a loop of independent integer adds. The variables are all independent of one another, which should allow for some great instruction level parallelism. The code loops many times, which should make for some easily predictable branches. My code is hardly optimal but I did keep track of how many millions of adds were executed per second. I also reported how long each iteration of the loop took, on average.</p><table align=center border=0 cellpadding=0 cellspacing=1 width=575><tbody readability=5><tr class=tgrey><td align=center colspan=7>Integer Add Code</td></tr><tr class=tlblue readability=8><td width=120>&nbsp;</td><td align=center valign=middle width=85>Apple A5 (2 x Cortex A9 @ 800MHz</td><td align=center valign=middle width=85>Apple A5 Scaled (2 x Cortex A9 @ 1300MHz</td><td align=center valign=middle width=85>Apple A6 (2 x Swift @ 1300MHz</td><td align=center valign=middle width=85>Swift / A9 Perf Advantage @ 1300MHz</td></tr><tr><td class=tlgrey>Integer Add Test</td><td align=center valign=middle>207 MIPS</td><td align=center valign=middle>336 MIPS</td><td align=center valign=middle>369 MIPS</td><td align=center valign=middle>9.8%</td></tr><tr readability=2><td class=tlgrey>Integer Add Latency in Clocks</td><td align=center valign=middle>23 clocks</td><td align=center valign=middle>&nbsp;</td><td align=center valign=middle>21 clocks</td><td align=center valign=middle>&nbsp;</td></tr></tbody></table><p>The code here should be fairly bound by the integer execution path. We're showing a 9.8% increase in performance. Average latency is improved slightly by 2 clocks, but we're not seeing the sort of ILP increase that would come from having a third ALU that can easily be populated. The slight improvement in performance here could be due to a number of things. A quick look at some of Apple's own documentation confirms what we've seen here: Swift has two integer ALUs and can issue 3 operations per cycle (implying a 3-wide decoder as well). I don't know if the third decoder is responsible for the slight gains in performance here or not.</p><p align=center><img height=73 src=https://cdn.statically.io/img/images.anandtech.com/reviews/smartphones/apple/iPhone5/review/swift.jpg width=600 style=margin:auto;display:block;text-align:center;max-width:100%;height:auto></p><p>What about floating point performance? ARM's Cortex A9 only has a single issue port for FP operations which seriously hampers FP performance. Here I modified the code from earlier to do a bunch of single and double precision FP multiplies:</p><table align=center border=0 cellpadding=0 cellspacing=1 width=575><tbody readability=6><tr class=tgrey><td align=center colspan=7>FP Add Code</td></tr><tr class=tlblue readability=8><td width=120>&nbsp;</td><td align=center valign=middle width=85>Apple A5 (2 x Cortex A9 @ 800MHz</td><td align=center valign=middle width=85>Apple A5 Scaled (2 x Cortex A9 @ 1300MHz</td><td align=center valign=middle width=85>Apple A6 (2 x Swift @ 1300MHz</td><td align=center valign=middle width=85>Swift / A9 Perf Advantage @ 1300MHz</td></tr><tr readability=2><td class=tlgrey>FP Mul Test (single precision)</td><td align=center valign=middle>94 MFLOPS</td><td align=center valign=middle>153 MFLOPS</td><td align=center valign=middle>143 MFLOPS</td><td align=center valign=middle>-7%</td></tr><tr readability=2><td class=tlgrey>FP Mul Test (double precision)</td><td align=center valign=middle>87 MFLOPS</td><td align=center valign=middle>141 MFLOPS</td><td align=center valign=middle>315 MFLOPS</td><td align=center valign=middle>123%</td></tr></tbody></table><p>There's actually a slight regression in performance if we look at single precision FP multiply performance, likely due to the fact that performance wouldn't scale perfectly linearly from 800MHz to 1.3GHz. Notice what happens when we double up the size of our FP multiplies though, performance goes up on Swift but remains unchanged on the Cortex A9. Given the support for ARM's VFPv4 extensions, Apple likely has a second FP unit in Swift that can help with FMAs or to improve double precision FP performance. It's also possible that Swift is a 128-bit wide NEON machine and my DP test compiles down to NEON code which enjoys the benefits of a wider engine. I ran the same test with FP adds and didn't notice any changes to the data above.</p><h2>Sanity Check with Linpack & Passmark</h2><p>Section by Anand Shimpi</p><p>Not completely trusting my own code, I wanted some additional data points to help understand the Swift architecture. I first turned to the iOS port of Linpack and graphed FP performance vs. problem size:</p><p align=center><a href=#><img border=0 height=384 src=https://cdn.statically.io/img/images.anandtech.com/reviews/smartphones/apple/iPhone5/review/linpack.jpg width=600 style=margin:auto;display:block;text-align:center;max-width:100%;height:auto></a></p><p>Even though I ran the benchmark for hundreds of iterations at each data point, the curves didn't come out as smooth as I would've liked them to. Regardless there's a clear trend. Swift maintains a huge performance advantage, even at small problem sizes which supports the theory of having two ports to dedicated FP hardware. There's also a much smaller relative drop in performance when going out to main memory. If you do the math on the original unscaled 4S scores you get the following data:</p><table align=center border=0 cellpadding=0 cellspacing=1 width=575><tbody readability=3><tr class=tgrey readability=2><td align=center colspan=5>Linpack Throughput: Cycles per Operation</td></tr><tr class=tlblue readability=4><td width=120>&nbsp;</td><td align=center valign=middle width=85>Apple Swift @ 1300MHz (iPhone 5)</td><td align=center valign=middle width=85>ARM Cortex A9 @ 800MHz (iPhone 4S)</td></tr><tr><td class=tlgrey>~300KB Problem Size</td><td align=center valign=middle>1.45 cycles</td><td align=center valign=middle>3.55 cycles</td></tr><tr><td class=tlgrey>~8MB Problem Size</td><td align=center valign=middle>2.08 cycles</td><td align=center valign=middle>6.75 cycles</td></tr><tr><td class=tlgrey>Increase</td><td align=center valign=middle>43%</td><td align=center valign=middle>90%</td></tr></tbody></table><p>Swift is simply able to hide memory latency better than the Cortex A9. Concurrent FP/memory operations seem to do very well on Swift...</p><p>As the last sanity check I used Passmark, another general purpose iOS microbenchmark.</p><table align=center border=0 cellpadding=0 cellspacing=1 width=575><tbody readability=4><tr class=tgrey><td align=center colspan=7>Passmark CPU Performance</td></tr><tr class=tlblue readability=8><td width=120>&nbsp;</td><td align=center valign=middle width=85>Apple A5 (2 x Cortex A9 @ 800MHz</td><td align=center valign=middle width=85>Apple A5 Scaled (2 x Cortex A9 @ 1300MHz</td><td align=center valign=middle width=85>Apple A6 (2 x Swift @ 1300MHz</td><td align=center valign=middle width=85>Swift / A9 Perf Advantage @ 1300MHz</td></tr><tr><td class=tlgrey>Integer</td><td align=center valign=middle>257</td><td align=center valign=middle>418</td><td align=center valign=middle>614</td><td align=center valign=middle>47.0%</td></tr><tr><td class=tlgrey>FP</td><td align=center valign=middle>230</td><td align=center valign=middle>374</td><td align=center valign=middle>813</td><td align=center valign=middle>118%</td></tr><tr><td class=tlgrey>Primality</td><td align=center valign=middle>54</td><td align=center valign=middle>87</td><td align=center valign=middle>183</td><td align=center valign=middle>109%</td></tr><tr><td class=tlgrey>String qsort</td><td align=center valign=middle>1065</td><td align=center valign=middle>1730</td><td align=center valign=middle>2126</td><td align=center valign=middle>22.8%</td></tr><tr><td class=tlgrey>Encryption</td><td align=center valign=middle>38.1</td><td align=center valign=middle>61.9</td><td align=center valign=middle>93.5</td><td align=center valign=middle>51.0%</td></tr><tr><td class=tlgrey>Compression</td><td align=center valign=middle>1.18</td><td align=center valign=middle>1.92</td><td align=center valign=middle>2.26</td><td align=center valign=middle>17.9%</td></tr></tbody></table><p>The integer math test uses a large dataset and performs a number of add, subtract, multiply and divide operations on the values. The dataset measures 240KB per core, which is enough to stress the L2 cache of these processors. Note the 47% increase in performance over a scaled Cortex A9.</p><p>The FP test is identical to the integer test (including size) but it works on 32 and 64-bit floating point values. The performance increase here despite facing the same workload lends credibility to the theory that there are multiple FP pipelines in Swift.</p><p>The Primality benchmark is branch heavy and features a lot of FP math and compares. Once again we see huge scaling compared to the Cortex A9.</p><p>The qsort test features integer math and is very branch heavy. The memory footprint of the test is around 5MB, but the gains here aren't as large as we've seen elsewhere. It's possible that Swift features a much larger branch mispredict penalty than the A9.</p><p>The Encryption test works on a very small dataset that can easily fit in the L1 cache but is very heavy on the math. Performance scales very well here, almost mirroring the integer benchmark results.</p><p>Finally the compression test shows us the smallest gains once you take into account Swift's higher operating frequency. There's not much more to conclude here other than we won't always see greater than generational scaling from Swift over the previous Cortex A9.</p><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmivp6x7orrAp5utnZOde6S7zGiqoaenZIN0f49oq6GdXZ69qbvNnmRuZaKaw6qx1mht</p></div></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=./does-bad-vegan-anthony-strangis-have-mental-health-issues.html rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>Does Bad Vegan Anthony Strangis Have Mental Health Issues?</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=./brenno-leone.html rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>Brenno Leone</p></a></div></nav></div><aside class=sidebar><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=./alex-young.html>Alex Young Bio, Age, Net Worth, Facts, Height, Career, Married</a></li><li class=widget__item><a class=widget__link href=./all-we-know-about-gangsta-boos-boyfriend-emmett.html>All We Know About Gangsta Boos Boyfriend, Emmett</a></li><li class=widget__item><a class=widget__link href=./chuck-berry-net-worth-2024-2.html>Chuck Berry Net Worth 2024</a></li><li class=widget__item><a class=widget__link href=./faze-jarvis.html>Faze Jarvis - Bio, Age, Net Worth, Height, In Relation, Facts</a></li><li class=widget__item><a class=widget__link href=./indiana-jones-and-the-dial-of-destiny-director-comes-out-swinging-to-take-down-the-trolls.html>Indiana Jones and the Dial of Destiny director comes out swinging to take down the trolls</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=./categories/blog/>blog</a></li></ul></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2024 BlinkVib.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=https://assets.cdnweb.info/hugo/mainroad/js/menu.js></script>
<script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>